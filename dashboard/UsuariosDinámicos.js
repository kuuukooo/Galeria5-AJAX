$(document).ready(function(){function o(){$.ajax({url:"consultadeUsuarios.php",type:"GET",dataType:"json",success:function(o){$("#tablaUsuarios tbody").empty(),$.each(o,function(o,e){var a="editEmployeeModal_"+e.id_usuario,t="deleteEmployeeModal_"+e.id_usuario;$("#tablaUsuarios tbody").append("<tr><td><span class='custom-checkbox'><input type='checkbox' id='checkbox"+e.id_usuario+"' name='options[]' value='"+e.id_usuario+"'><label for='checkbox"+e.id_usuario+"'></label></span></td><td>"+e.id_usuario+"</td><td>"+e.Usuario+"</td><td>"+e.correo+"</td><td>"+e.numerotel+"</td><td>"+e.tipo_usuario+"</td><td><a href='#' class='edit' data-id='"+e.id_usuario+"'><i class='material-icons' data-toggle='tooltip' title='Edit'>&#xE254;</i></a><a href='#' class='delete' data-id='"+e.id_usuario+"'><i class='material-icons' title='Delete' id='"+t+"'>&#xE872;</i></a></td></tr>"),$("body").append("<div id='"+a+"' class='modal fade'><div class='modal-dialog'><div class='modal-content'><form method='post' action='EditarUsuario.php' class='editUserForm' data-id='"+e.id_usuario+"'><div class='modal-header'><h4 class='modal-title'>Editar Usuario</h4><button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button></div><div class='modal-body'><div class='form-group'><label for='usuario'>Usuario</label><input type='text' minlength='4' maxlength='10' id='usuario' class='form-control' required><input type='hidden' id='id_usuario' name='id_usuario' value=''></div><div class='form-group'><label for='contrasena'>Contrase\xf1a</label><input type='password' minlength='8' maxlength='16' id='contrasena' class='form-control' required></div><div class='form-group'><label for='correo'>Correo</label><input type='email' id='correo' class='form-control' required ></div><div class='form-group'><label for='telefono'>Tel\xe9fono</label><input type='tel' minlength='10' maxlength='10' id='telefono' class='form-control' required></div><div class='form-group'><label for='tipousuario' class='form-label'>TipoUsuario</label><select id='tipousuario' class='form-select' required><option value='Admin'>Admin</option><option value='Usuario'>Usuario</option></select></div><div class='modal-footer'><input type='button' class='btn btn-danger' data-bs-dismiss='modal' value='Cancel' id='BotonCancelarEditar'><input type='button' class='btn btn-success btn-edit' value='Editar' id='BotonEditar'></div></div></form></div></div></div>")})},error:function(o){console.log("Error al obtener los datos de usuarios:",o)}})}o(),$(document).ready(function(){$("#addUserForm").submit(function(e){e.preventDefault();var a=$("#usuario").val(),t=$("#contrasena").val(),i=$("#correo").val(),r=$("#telefono").val(),s=$("#tipousuario").val();$.ajax({url:"A\xf1adirUsuario.php",type:"POST",data:{usuario:a,contrasena:t,correo:i,telefono:r,tipousuario:s},success:function(e){e.success?(o(),$("#addEmployeeModal").modal("hide"),setTimeout(function(){alert("Usuario agregado correctamente")},500),$("#addUserForm")[0].reset()):$("#error-message-tipousuario").text(e.message)},error:function(o){console.log("Error en la solicitud AJAX:",o)}})})}),$(document).ready(function(){$("#tablaUsuarios").on("click",".delete",function(e){e.preventDefault();let a=confirm("\xbfEst\xe1s seguro que quieres eliminar este usuario?");var t=$(this).attr("data-id");console.log("ID de usuario:",t),a?$.ajax({url:"BorrarUsuario.php",method:"GET",data:{id_usuario:t},dataType:"json",success:function(e){e.success?(o(),setTimeout(function(){alert("Usuario eliminado correctamente")},500)):(alert("Error al eliminar usuario: "+e.message),console.log("ID de usuario en caso de error:",t))},error:function(o){console.log("Error en la solicitud AJAX:",o)}}):alert("No se ha eliminado el usuario")})}),$(document).ready(function(){$("#tablaUsuarios").on("click",".edit",function(){var o=$(this).data("id"),e="editEmployeeModal_"+o;console.log("El ID del Usuario es: "+o),$.ajax({url:"editarUsuarioConsulta.php",type:"GET",data:{id_usuario:o},dataType:"json",success:function(o){$("#"+e).modal("toggle"),$("#"+e+" #usuario").val(o.Usuario),$("#"+e+" #contrasena").val(o.contrasena),$("#"+e+" #correo").val(o.correo),$("#"+e+" #telefono").val(o.numerotel),$("#"+e+" #tipousuario").val(o.tipo_usuario)},error:function(o){console.log("Error al obtener los datos del usuario:",o)}})}),$(document).on("click",".btn-edit",function(){var e=$(this).closest("form.editUserForm"),a={id_usuario:e.data("id"),usuario:e.find("#usuario").val(),contrasena:e.find("#contrasena").val(),correo:e.find("#correo").val(),telefono:e.find("#telefono").val(),tipousuario:e.find("#tipousuario").val()};$.ajax({url:e.attr("action"),type:e.attr("method"),data:a,success:function(a){console.log("Respuesta del servidor:",a),a.success&&(e.closest(".modal").modal("hide"),o(),setTimeout(function(){alert("Usuario editado correctamente")},500))},error:function(o){console.log("Error en la solicitud AJAX:",o)}})})}),$(document).ready(function(){var o=$("#noResultsMessage");$("#tableSearch").on("keyup",function(){var e=$(this).val().toLowerCase(),a=$("#myTable tr");a.filter(function(){var o=$(this).text().toLowerCase().indexOf(e)>-1;$(this).toggle(o)}),o.toggle(0===a.filter(":visible").length)})}),$(document).ready(function(){$('[data-bs-toggle="tooltip"]').tooltip(),$(document).on("change","#selectAll",function(){var o=$(this).prop("checked");$('table tbody input[type="checkbox"]').prop("checked",o)}),$(document).on("change",'table tbody input[type="checkbox"]',function(){var o=$(this).closest("tr").find(".edit").data("id");console.log("ID del elemento:",o);var e=$('table tbody input[type="checkbox"]:checked').length===$('table tbody input[type="checkbox"]').length;$("#selectAll").prop("checked",e)}),$(document).on("click","#borrarVariosUsuarios",function(){let e=confirm("\xbfEst\xe1s seguro que quieres eliminar este usuario?");var a=[];$("table tbody tr").each(function(){if($(this).find('input[type="checkbox"]').prop("checked")){var o=$(this).find(".edit").data("id");a.push(o)}}),console.log("IDs seleccionados para eliminar:",a),e?a.length>0&&$.ajax({url:"BorradoVariosUsuarios.php",type:"POST",dataType:"json",data:{id_usuario:a},success:function(e){e.success?console.log(e.message):(console.log("Usuario borrado: "+a),o())},error:function(o){console.error("Error en la solicitud AJAX:",o)}}):($("table tbody tr").each(function(){var o=$(this).find('input[type="checkbox"]');o.prop("checked")&&o.prop("checked",!1)}),alert("No se ha eliminado el usuario")),$("#selectAll").prop("checked",!1)})})});